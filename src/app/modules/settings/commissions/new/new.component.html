<mat-vertical-stepper [selectedIndex]="selectedIndex" *transloco="let t">
  <!-- Étape 1 : Type -->
  <mat-step [stepControl]="typeForm">
    <ng-template matStepLabel>
      {{ t('entities.commission.form.step_one_title') }}
    </ng-template>
    <form [formGroup]="typeForm">
      <mat-radio-group formControlName="type">
        <mat-radio-button value="COMMISSION">{{ t('entities.commission.label') }}</mat-radio-button>
        <mat-radio-button value="CONTRIBUTOR">{{ t('entities.commission_contributor.label') }}</mat-radio-button>
      </mat-radio-group>
      <button mat-button (click)="nextStep(typeForm)">
        {{ t('form.actions.next') }}
      </button>
    </form>
  </mat-step>

  <!-- Étape 2 : Base de calcul -->
  <mat-step [stepControl]="baseForm">
    <ng-template matStepLabel>
      {{ t('entities.commission.form.step_two_title') }}
    </ng-template>
    <form [formGroup]="baseForm">
      <mat-form-field class="w-full">
        <mat-label>{{ t('entities.commission.fields.calculationBase') }}</mat-label>
        <mat-select formControlName="calculationBase">
          <mat-option *ngFor="let option of calculationBases" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div class="flex justify-end">
        <button mat-button (click)="previousStep()">{{ t('form.actions.previous') }}</button>
        <button mat-button (click)="nextStep(baseForm)">{{ t('form.actions.next') }}</button>
      </div>
    </form>
  </mat-step>

  <!-- Étape 3 : Formulaire dynamique -->
  <mat-step [stepControl]="isCommission() ? commissionForm : contributorForm">
    <ng-template matStepLabel>
      {{ t('entities.commission.form.step_three_title') }}
    </ng-template>
    <form [formGroup]="isCommission() ? commissionForm : contributorForm">
      <ng-container *ngIf="isCommission(); else contributorFields">
        <!-- Champs de Commission -->
        <mat-form-field class="w-full">
          <mat-label>{{ t('entities.commission.fields.managementRate') }}</mat-label>
          <input matInput type="number" formControlName="managementRate" />
        </mat-form-field>
        <!-- autres champs... -->
      </ng-container>
      <ng-template #contributorFields>
        <!-- Champs de CommissionContributor -->
        <mat-form-field class="w-full">
          <mat-label>{{ t('entities.commission_contributor.fields.contributorRate') }}</mat-label>
          <input matInput type="number" formControlName="contributorRate" />
        </mat-form-field>
        <!-- autres champs... -->
      </ng-template>
      <div class="flex justify-end">
        <button mat-button (click)="previousStep()">{{ t('form.actions.previous') }}</button>
        <button mat-button (click)="setSummary(); nextStep(isCommission() ? commissionForm : contributorForm)">
          {{ t('form.actions.next') }}
        </button>
      </div>
    </form>
  </mat-step>

  <!-- Étape 4 : Résumé -->
  <mat-step>
    <ng-template matStepLabel>
      {{ t('form.summary.title') }}
    </ng-template>
    <div class="space-y-2 text-sm">
      <div><strong>{{ t('entities.commission.fields.calculationBase') }}:</strong> {{ summary.calculationBase }}</div>
      <div *ngIf="isCommission()">
        <strong>{{ t('entities.commission.fields.managementRate') }}:</strong> {{ summary.managementRate }}
      </div>
      <div *ngIf="!isCommission()">
        <strong>{{ t('entities.commission_contributor.fields.contributorRate') }}:</strong> {{ summary.contributorRate }}
      </div>
    </div>
    <div class="flex justify-end gap-4 mt-4">
      <button mat-button (click)="previousStep()">{{ t('form.actions.previous') }}</button>
      <button mat-flat-button color="primary" (click)="save()">
        {{ t('form.actions.save') }}
      </button>
    </div>
  </mat-step>
</mat-vertical-stepper>
