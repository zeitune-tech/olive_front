<!-- Sign in form -->
<form
    class="mt-8 space-y-6"
    #form
    [formGroup]="formGroup"
    *transloco="let t">
    
    <div class="flex flex-col gap-4">

        <div class="flex items-center">
            <!-- Seach -->
            <mat-form-field class="w-full" appearance="outline">
                <mat-label>{{ t('permissions.table.search') }}</mat-label>
                <input
                    matInput
                    placeholder="{{ t('permissions.table.search') }}"
                    formControlName="search"
                />
            </mat-form-field>
            <!-- Choosed -->
            <button
                mat-button
                mat-flat-button
                [color]="'primary'"
                (click)="preview()"
                class="ml-4">
                {{ t('permissions.table.choosed') }}
            </button>
        </div>

        <!-- Table -->
        <table [dataSource]="dataSource" class="w-full rounded-md bg-card" mat-table matSort>
        
            <!-- Checkbox Column -->
            <ng-container matColumnDef="checkbox">
                <th mat-header-cell *matHeaderCellDef mat-header-cell class="uppercase text-center">
                    <mat-checkbox
                        (change)="masterToggle()"
                        [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()"
                    ></mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row" class="text-center">
                    <mat-checkbox
                        (change)="toggleSelection(row)"
                        [checked]="selection.isSelected(row)"
                        [aria-label]="t('permissions.table.select-row')"
                    ></mat-checkbox>
                </td>
            </ng-container>

            <!-- Text Columns -->
            @let columns = tableOptions.columns;
            <ng-container *ngFor="let column of columns; trackBy: trackByProperty">
                <ng-container *ngIf="column.type === 'text'" [matColumnDef]="column.property">
                    <th *matHeaderCellDef class="uppercase" mat-header-cell mat-sort-header>{{ t(column.label) }}</th>
                    <td *matCellDef="let row" [ngClass]="column.cssClasses" mat-cell>
                        {{ tableOptions.renderItem(row, column.property) }}
                    </td>
                </ng-container>
            </ng-container>


            <tr *matHeaderRowDef="visibleColumns" mat-header-row></tr>
            <tr *matRowDef="let row; columns: visibleColumns;"
                @fadeInBottom
                class="trans-ease-out cursor-pointer"
                mat-row>
            </tr>

            <!-- No Data Row -->
            <tr *matNoDataRow>
                <td [attr.colspan]="visibleColumns.length" class="text-center py-4">
                    {{ t('permissions.table.no-data') }}
                </td>
            </tr>
        </table>

        @let pageSizeOptions = tableOptions.pageSizeOptions;
        @let pageSize = tableOptions.pageSize;
        <mat-paginator class="rounded-b-md border-t" [pageSizeOptions]="pageSizeOptions" [pageSize]="pageSize"></mat-paginator>

    </div>
    
    <!-- Submit button -->
    <button mat-button matStepperNext
        class="mat-button-large  mt-6"
        mat-flat-button
        [color]="'primary'"
        [disabled]="formGroup.invalid"
        (click)="onNext()"
        >
        {{ t('permissions.table.next') }}
    </button>
</form>